"0","# Step 1: Create ranking dataset"
"0","ranked <- merged %>%"
"0","  mutate("
"0","    rank_total = rank(-overall_homeless),           # Rank by total homeless (descending)"
"0","    rank_rate = rank(-homeless_per_10000)           # Rank by homelessness rate (descending)"
"0","  )"
"0",""
"0","# Step 2: Filter top 20 by rank discrepancy"
"0","dumbbell_data <- ranked %>%"
"0","  mutate(diff = abs(rank_total - rank_rate)) %>%"
"0","  arrange(desc(diff)) %>%"
"0","  slice_head(n = 20)"
"0",""
"0","# Step 3: Create dumbbell chart"
"0","dumbbell_chart <- ggplot(dumbbell_data, aes(y = reorder(state, diff))) +"
"0","  geom_segment(aes(x = rank_total, xend = rank_rate, yend = state), color = ""#999999"", linewidth = 1) +"
"0","  geom_point(aes(x = rank_total), color = ""#2A75B3"", size = 3) +"
"0","  geom_point(aes(x = rank_rate), color = ""#FF6F00"", size = 3) +"
"0","  labs("
"0","    title = ""States with Largest Rank Discrepancies"","
"0","    subtitle = ""Ranking gap between total count and per capita rate of homelessness"","
"0","    x = ""Rank (1 = Highest)"","
"0","    y = NULL,"
"0","    caption = ""Source: HUD AHAR 2023"""
"0","  ) +"
"0","  theme_reason() +"
"0","  theme("
"0","    axis.text.y = element_text(size = 10),"
"0","    panel.grid = element_blank()"
"0","  )"
"0",""
"0","# Add logo"
"0","dumbbell_chart_plot <- ggdraw(dumbbell_chart) +"
"0","  draw_image(logo, x = 0.01, y = -0.03, width = 0.14, height = 0.14, hjust = 0, vjust = 0)"
"0",""
"0",""
"0","ggsave("
"0","  here(""Dumbbell_Rank_Discrepancy_Homelessness_2023.pdf""),"
"0","  plot = dumbbell_chart_plot,"
"0","  width = 6.2,"
"0","  height = 6,"
"0",")"
"0",""
"0","print(dumbbell_chart_plot)"
